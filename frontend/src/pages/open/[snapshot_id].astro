---
import Layout from '../../layouts/Layout.astro';
import SnapshotDashboard from '../../components/SnapshotDashboard.jsx';

const { snapshot_id } = Astro.params;
const url = Astro.url;

if (snapshot_id === 'total') return Astro.redirect('/');

const channelId = url.searchParams.get('channel');
let userId = url.searchParams.get('user') || Astro.cookies.get('user_id')?.value;
if (userId === 'guest') userId = null;

Astro.response.headers.set('Cache-Control', 'public, s-maxage=86400, max-age=3600');
---

{/* タイトルを動的に設定（Snapshot #ID） */}
<Layout title={`Snapshot #${snapshot_id}`}>
    <SnapshotDashboard 
        client:load 
        snapshotId={snapshot_id} 
        channelId={channelId} 
        userId={userId} 
    />
</Layout>